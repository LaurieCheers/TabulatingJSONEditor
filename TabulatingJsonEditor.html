<html>
<head>
<style>
.SpecialValue{ font-weight: bold; font-style: italic; }

.StringValue{ color:purple; }
.NumberValue{ color:blue; }
.ObjValue{ color: red; }
.RootObjValue{ color: red; font-size: 15; font-weight: bold; }
.ObjRow{ color: red; font-weight: bold; }
.HiddenValue{ display:inline-block; width: 1px; opacity: 0; }

table {
  border-collapse: collapse;
  padding:0px;
  margin:0px;
}

.tableFrame {
  display: inline-block;
  border-style:solid;
  border-width:1px;
  border-bottom-width: 2px;
  padding:0px;
  margin:0px;
}

.objectFrame {
  display: inline-block;
  border-style:solid;
  border-color:#AA0000;
  border-width:1px;
  border-bottom-width: 2px;
  border-radius:10px;
  overflow:hidden;
  padding:0px;
  margin:0px;
}


td, th {
  padding: 2px;
  padding-left: 8px;
  padding-right: 8px;
  text-align: left;
  border-left: solid;
  border-left-color: #ddaadd;
}

td:first-child, th:first-child {
  border-left: none;
}

tr:nth-child(even) {
  background-color: #eedddd;
}

tr:nth-child(odd) {
  background-color: #ffffff;
}

</style>
<script>
var jsonTest = [
  { "Name":null, "Age":14, "abilities":{"trample":true} },
  { "Name":"Jill", "Age":[{"foo":[]}], loot:[{"id":1012}, {"id":1013}] },
  { "Name":"Mark", "Age":{"foo":[], "bar":[]}, loot:{"id":[1012,1013]} }
];

function OnLoad()
{
  //DisplayRootValue(jsonTest, document.body);
  
  var dropZone = document.body;
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
}

function DisplayJsonValue(json, node)
{
  if(json === null || json === undefined || typeof json === "number" || json === true || json === false)// || isNaN(json))
  {
    DisplayStyledString(""+json, "NumberValue", node);
  }
  else if(typeof json === "string")
  {
    DisplayStyledString("\""+json+"\"", "StringValue", node);
  }
  else
  {
	DisplayShaped(json, GetContainerShape(json), node);
  }
}

function DisplayStyledString(string, className, node)
{
  var span = document.createElement("SPAN");
  span.className = className;
  span.appendChild( document.createTextNode(string) );
  node.appendChild( span );
}

function DisplaySpecialNode(value, node)
{
  node.appendChild( document.createTextNode(""+value) );
}

function GetContainerShape(container)
{
  var result = [];
  
  if(typeof container !== "object")
    return result;

  result.push(Array.isArray(container));

  var type1 = undefined;
  var type2 = undefined;
  
  for(var colName0 in container)
  {
    var item1 = container[colName0];
	
    if(typeof item1 !== "object")
      return result;
    
	var itemType1 = Array.isArray(item1);
	if(type1 === undefined)
	  type1 = itemType1;
	else if(type1 !== itemType1)
	  return result;
	
    for(var colName1 in item1)
    {
      var item2 = item1[colName1];
	  
      if(typeof item2 !== "object")
	  {
        type2 = null;
		break;
	  }
    
	  var itemType2 = Array.isArray(item2);
	  if(type2 === undefined)
	    type2 = itemType2;
	  else if(type2 !== itemType2)
	  {
        type2 = null;
		break;
	  }
	}	
  }
  
  if(type1 === true || type1 === false)
  {
    result.push(type1);
	
	if(type2 === true || type2 === false)
	  result.push(type2);
  }
  
  return result;
}

function DisplayShaped(obj, shape, node)
{
  if(shape.length === 1)
  {
    if(shape[0])
	  DisplaySimpleArray(obj, node);
	else
	  DisplaySimpleObject(obj, node);
  }
  else if(shape.length === 2)
  {
    var rowHeaders = (shape[0] === false);
	var colHeaders = (shape[1] === false);

	var columnNames = [];
	var numRows = 0;
	var numColumns = 0;
    for(var key in obj)
    {
	  var row = obj[key];
	  numRows++;
      if(colHeaders)
	  {
	    for(var colName in row)
	    {
	      if(!columnNames.includes(colName))
	      {
		    columnNames.push(colName);
			numColumns++;
	      }
	    }
	  }
	  else if(numColumns < row.length)
	  {
	    numColumns = row.length;
	  }
    }
	
	if(numRows === 0)
	{
		DisplayShaped(obj, [shape[0]], node);
		return;
	}
	
	if(!colHeaders && numColumns === 0)
	{
	  numColumns = 1;
	}
	
    var isFirstEntry = true;	
	var table = CreateTable(node, "tableFrame");
	if(colHeaders)
	{
	  var headings = document.createElement("TR");
	  table.appendChild(headings);
	  if(rowHeaders)
	    headings.appendChild(document.createElement("TH")); // space for the row headers

	  for(var Idx = 0; Idx < columnNames.length; ++Idx)
	  {
		var heading = document.createElement("TH");
		DisplayStyledString(columnNames[Idx]+":", "ObjValue", heading);
		headings.appendChild(heading);
	  }
	}
		
	for(var rowName in obj)
	{
		var row = obj[rowName];
		var rowNode = document.createElement("TR");
		if(rowHeaders)
		{
		  var rowHeader = document.createElement("TH");
		  DisplayStyledString(rowName+":", "ObjValue", rowHeader);
		  rowNode.appendChild(rowHeader);
		}
		if(colHeaders)
		{
		  for(var Idx = 0; Idx < columnNames.length; ++Idx)
		  {
			var cellNode = document.createElement("TD");
			if(row.hasOwnProperty(columnNames[Idx]))
				DisplayJsonValue(row[columnNames[Idx]], cellNode);
			else
				DisplayStyledString("missing", "SpecialValue", cellNode);
			rowNode.appendChild(cellNode);
		  }
		}
		else
		{
		  for(var Idx = 0; Idx < numColumns; ++Idx)
		  {
			var cellNode = document.createElement("TD");
			if(row.length > Idx)
				DisplayJsonValue(row[Idx], cellNode);
			else
				DisplayStyledString("missing", "SpecialValue", cellNode);
			rowNode.appendChild(cellNode);
		  }
		}
		table.appendChild(rowNode);
	}
  }
  else if(shape.length === 3)
  {
    var row1Headers = (shape[0] === false);
    var row2Headers = (shape[1] === false);
	var colHeaders = (shape[2] === false);
	
	if(row1Headers || row2Headers)
	{
	  row1Headers = true;
	  row2Headers = true;
	}

    var row2Names = [];
	var columnNames = [];
	var numColumns = 0;
    for(var key in obj)
    {
	  var row1 = obj[key];
	  for(var row2Name in obj[key])
	  {
	    if(row2Headers && !row2Names.includes(row2Name))
	    {
		  row2Names.push(row2Name);
	    }
	    if(colHeaders)
	    {
		  for(var colName in row1[row2Name])
		  {
		    if(!columnNames.includes(colName))
		    {
			  columnNames.push(colName);
		    }
		  }
	    }
	    else if(numColumns < row1.length)
	    {
		  numColumns = row1.length;
	    }
	  }
    }
	
	if(!colHeaders && numColumns === 0)
	{
	  numColumns = 1;
	}
	
    var isFirstEntry = true;
	var table = CreateTable(node, "tableFrame");
	if(colHeaders)
	{
	  var headings = document.createElement("TR");
	  table.appendChild(headings);
	  if(row1Headers)
	    headings.appendChild(document.createElement("TH")); // space for the row headers
	  if(row2Headers)
	    headings.appendChild(document.createElement("TH")); // space for the row headers

	  for(var Idx = 0; Idx < columnNames.length; ++Idx)
	  {
		var heading = document.createElement("TH");
		DisplayStyledString(columnNames[Idx]+":", "ObjValue", heading);
		headings.appendChild(heading);
	  }
	}
		
	for(var row1Name in obj)
	{
	  var row1 = obj[row1Name];
	  var row1First = true;
	  for(var row2Name in row1)
	  {
	    var row2 = row1[row2Name];
		var rowNode = document.createElement("TR");
		if(row1Headers)
		{
		  var row1Header = document.createElement("TH");
		  if(row1First)
			DisplayStyledString(row1Name+":", "ObjValue", row1Header);
		  rowNode.appendChild(row1Header);
		  row1First = false;
		}
		if(row2Headers)
		{
		  var row2Header = document.createElement("TH");
		  DisplayStyledString(row2Name+":", "ObjValue", row2Header);
		  rowNode.appendChild(row2Header);
		}
		if(colHeaders)
		{
		  for(var Idx = 0; Idx < columnNames.length; ++Idx)
		  {
			var cellNode = document.createElement("TD");
			if(row2.hasOwnProperty(columnNames[Idx]))
				DisplayJsonValue(row2[columnNames[Idx]], cellNode);
			else
				DisplayStyledString("missing", "SpecialValue", cellNode);
			rowNode.appendChild(cellNode);
		  }
		}
		else
		{
		  for(var Idx = 0; Idx < numColumns; ++Idx)
		  {
			var cellNode = document.createElement("TD");
			if(row2.length > Idx)
				DisplayJsonValue(row2[Idx], cellNode);
			else
				DisplayStyledString("missing", "SpecialValue", cellNode);
			rowNode.appendChild(cellNode);
		  }
		}
		table.appendChild(rowNode);
	  }
	}
  }
}

function CreateTable(node, className)
{
	var tableContainer = document.createElement("DIV");
	tableContainer.className = className;
	var table = document.createElement("TABLE");
	table.cellSpacing = 0;
	tableContainer.appendChild(table);
	node.appendChild(tableContainer);
	return table;
}

/*
function DisplayArray(array, node)
{
  var columns = [];

  for(var Idx = 0; Idx < array.length; ++Idx)
  {
    var item = array[Idx];
    if(typeof item !== "object" || Array.isArray(item))
	{
	  DisplaySimpleArray(array, node);
	  return;
	}
	
	for(var key in array[Idx])
	{
	  if(!columns.includes(key))
	    columns.push(key);
	}
  }
  
  DisplayStyledString("[", "ObjValue", node);
  var table = document.createElement("TABLE");
  var headings = document.createElement("TR");
  table.appendChild(headings);
  for(var Idx = 0; Idx < columns.length; ++Idx)
  {
    var heading = document.createElement("TH");
    DisplayStyledString(columns[Idx]+":", "ObjValue", heading);
    headings.appendChild(heading);
  }

  for(var Idx = 0; Idx < array.length; ++Idx)
  {
    var row = document.createElement("TR");
	var rowValue = array[Idx];
    for(var colIdx = 0; colIdx < columns.length; ++colIdx)
    {
	  var cell = document.createElement("TD");
	  row.appendChild(cell);
      if(colIdx === 0)
	    DisplayStyledString("{", "HiddenValue", cell);
		
      DisplayStyledString(columns[colIdx]+":", "HiddenValue", cell);
	  if(rowValue.hasOwnProperty(columns[colIdx]))
	  {
		DisplayJsonValue(rowValue[columns[colIdx]], cell);
	  }
	  else
	  {
		DisplayStyledString("missing", "SpecialValue", cell);
	  }
	  if(colIdx+1 < columns.length)
		DisplayStyledString(",", "HiddenValue", cell);
	  else if(Idx+1 < array.length)
		DisplayStyledString("},", "HiddenValue", cell);
	  else
		DisplayStyledString("}", "HiddenValue", cell);
	}
	table.appendChild(row);
  }
  node.appendChild(table);
  DisplayStyledString("]", "ObjValue", node);
}
*/
function DisplaySimpleArray(array, node)
{
  if(array.length === 0)
  {
	  DisplayStyledString("[]", "ObjValue", node);
/*
	  DisplayStyledString("[", "ObjValue", node);
	  for(var Idx = 0; Idx < array.length; ++Idx)
	  {
		DisplayJsonValue(array[Idx], node);
		if(Idx+1 < array.length)
			DisplayStyledString(", ", "ObjValue", node);
	  }
	  DisplayStyledString("]", "ObjValue", node);*/
  }
  else
  {
	  var table = CreateTable(node, "objectFrame");
	  var row = document.createElement("TR");
	  for(var Idx = 0; Idx < array.length; ++Idx)
	  {
		var item = document.createElement("TD");
		DisplayJsonValue(array[Idx], item);
		row.appendChild(item);
	  }
	  table.appendChild(row);
  }
}

function DisplaySimpleObject(obj, node)
{
	var isEmpty = true;
	for(var colName in obj)
	{
		isEmpty = false;
		break;
	}
	
	if(isEmpty)
	{
		DisplayStyledString("{}", "ObjValue", node);
		return;
	}
	
	var table = CreateTable(node, "objectFrame");
	var headings = document.createElement("TR");
	var cells = document.createElement("TR");
	for(var colName in obj)
	{
		var header = document.createElement("TH");
		DisplayStyledString(colName+":", "ObjValue", header);
		headings.appendChild(header);

		var cell = document.createElement("TD");
		DisplayJsonValue(obj[colName], cell);
		cells.appendChild(cell);
	}
	
	table.appendChild(headings);
	table.appendChild(cells);

/*
		var isFirstEntry = true;
		DisplayStyledString("{ ", "ObjValue", node);
		for(var key in obj)
		{
		  if(!isFirstEntry)
			DisplayStyledString(", ", "ObjValue", node);
				
		  DisplayStyledString(key+": ", "ObjValue", node);
		  DisplayJsonValue(obj[key], node);

		  isFirstEntry = false;
		}
		DisplayStyledString(" }", "ObjValue", node);
		*/
}

function DisplayRootValue(obj, node)
{
	if(typeof obj !== "object" || Array.isArray(obj))
	{
	  DisplayJsonValue(obj, node);
	}
	else
	{
		for(var key in obj)
		{
		  var heading = document.createElement("H2");
		  DisplayStyledString(key+": ", "ObjValue", heading);
		  node.appendChild(heading);
		  DisplayJsonValue(obj[key], node);
		}
	}
}

function WriteCell(container, index, newValue)
{
  container[index] = InterpretValue(newValue);
}

function InterpretValue(str)
{
  str = TrimWhitespace(str);
  if(str === "undefined")
    return undefined;
  else if(str === "null")
    return null;
  else if(str === "NaN")
    return NaN;
	
  var result = JSON.parse(str);
  if(result !== undefined)
    return result;
  
  return str;
}

function TrimWhitespace(str)
{
  var whitespaces = " \t\n\r";
  for(var Idx = 0; Idx < str.length; ++Idx)
  {
    if(!whitespaces.includes(str[Idx]))
	  break;
  }
  str = str.substring(Idx);
  for(var Idx = str.length-1; Idx >= 0; --Idx)
  {
    if(!whitespaces.includes(str[Idx]))
	  break;
  }
  return str.substring(0, Idx);
}

  function handleFileSelect(evt)
  {
    evt.stopPropagation();
    evt.preventDefault();

    var files = evt.dataTransfer.files; // FileList object.

    // files is a FileList of File objects. List some properties.
    var output = [];
    for (var i = 0; i < files.length; i++)
	{
	  var file = files[i];
	  var reader = new FileReader();
	  reader.readAsText(file, "UTF-8");
	  reader.onload = function (evt)
	  {
	    var jsonArea = document.getElementById("json_area");
		jsonArea.innerHTML = "";
        DisplayRootValue(JSON.parse(evt.target.result), document.getElementById("json_area"));
	  }
	  
	  reader.onerror = function (evt) {
        document.getElementById("json_area").innerHTML = "error reading file";
      }
    }
  }

  function handleDragOver(evt)
  {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'link'; // Explicitly show this is a copy.
  }
</script>
</head>
<body onload="OnLoad()">
<div id="drop_zone">Drop JSON files onto this page</div>
<div id="json_area"></div>
</body>
</html>